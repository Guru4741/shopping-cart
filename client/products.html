<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="vendors/css/normalizes.css">
    <link rel="stylesheet" href="res/css/products.css">
    <link rel="stylesheet" href="res/css/queries.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Dosis:400,600,700" rel="stylesheet">
    <title>SABKA BAZAAR</title>
</head>

<body>
    <header>
        <div class="row">
            <nav>
                <figure>
                    <img src="res/img/logo.png" alt="logo" class="logo">
                </figure>
                <ul class="links">
                    <li><a href="home.html">Home</a></li>
                    <li><a href="products.html">Products</a></li>
                </ul>
                <div class="cartBox">
                    <ul class="cartBox__links">
                        <li><a href="login.html">Sign In</a></li>
                        <li><a href="registration.html">Register</a></li>
                    </ul>
                    <div class="cart" onclick="showModalBox()">
                        <img src="res/img/cart.svg" alt="cart">
                        <p class="cart__items">0 items</p>
                    </div>

                </div>
                <!-- Simulate a smartphone / tablet -->


                <!-- Top Navigation Menu -->
                <div class="topnav">
                    <a href="javascript:void(0);" class="icon" onclick="myFunction()">
                        <i class="fa fa-bars"></i>
                    </a>
                </div>

                <!-- End smartphone / tablet look -->


            </nav>
        </div>
    </header>

    <section class="mobile-menu">
        <div class="row">
            <div id="myLinks">
                <a href="#">Register</a>
                <a href="#">Sign In</a>
                <a href="#">Home</a>
                <a href="#">Products</a>
            </div>
        </div>
    </section>
    <section class="section-products">
        <div class="row">
            <div class="section-product-categories">
                <ul>
                    <li><a href="#">Fruits & Vegetables</a></li>
                    <li><a href="#">Bakery, Cakes & Dairy</a></li>
                    <li><a href="#">Beverages</a></li>
                    <li><a href="#">Beauty & Hygiene</a></li>
                    <li><a href="#">Baby Care</a></li>
                </ul>
            </div>
            <div class="section-all-products">
                <div class="section-product">
                    <p class="section-product-title">
                        Fresho Kiwi - Green, 3 pcs
                    </p>
                    <div class="section-product-info">
                        <figure class="section-product-image">
                            <img src="res/img/products/fruit-n-veg/kiwi-green.jpg" alt="Kiwi Green">
                        </figure>
                        <p class="section-product-details">
                            Kiwis are oval shaped with a brownish outer skin. The flesh is bright green and juicy with
                            tiny,
                            edible black seeds.
                        </p>
                    </div>
                    <div class="section-product-cost">
                        <p class="section-product-rate">
                            MRP Rs.87
                        </p>
                        <button class="BuyBtn">Buy Now</button>
                    </div>
                </div>
                <div class="section-product">
                    <p class="section-product-title">
                        Apple - Washington, Regular, 4 pcs
                    </p>
                    <div class="section-product-info">
                        <figure class="section-product-image">
                            <img src="res/img/products/fruit-n-veg/apple.jpg" alt="Kiwi Green">
                        </figure>
                        <p class="section-product-details">
                            The bright red coloured and heart shaped Washington apples are crunchy, juicy and slightly
                            sweet. Washington Apples are a natural source of fibre and are fat free.
                        </p>
                    </div>
                    <div class="section-product-cost">
                        <p class="section-product-rate">
                            MRP Rs.187
                        </p>
                        <button class="BuyBtn">Buy Now</button>
                    </div>
                </div>
                <div class="section-product">
                    <p class="section-product-title">
                        Fresho Pomegrante Peeled, 500 gm
                    </p>
                    <div class="section-product-info">
                        <figure class="section-product-image">
                            <img src="res/img/products/fruit-n-veg/pomegrante.jpg" alt="Kiwi Green">
                        </figure>
                        <p class="section-product-details">
                            Pomegranate variety has a glossy, vibrant and soft ruby-red skin. The inside of the fruit is
                            divided into compartments by thin white membranes.
                        </p>
                    </div>
                    <div class="section-product-cost">
                        <p class="section-product-rate">
                            MRP Rs.88
                        </p>
                        <button class="BuyBtn">Buy Now</button>
                    </div>
                </div>
                <div class="section-product">
                    <p class="section-product-title">
                        Capsicum - Green, 1kg
                    </p>
                    <div class="section-product-info">
                        <figure class="section-product-image">
                            <img src="res/img/products/fruit-n-veg/capsicum-green.jpg" alt="Kiwi Green">
                        </figure>
                        <p class="section-product-details">
                            Leaving a moderately pungent taste on the tongue, Green capsicums, also known as green
                            peppers
                            are bell shaped, medium-sized fruit pods.
                        </p>
                    </div>
                    <div class="section-product-cost">
                        <p class="section-product-rate">
                            MRP Rs.137
                        </p>
                        <button class="BuyBtn">Buy Now</button>
                    </div>
                </div>

                <div class="section-product">
                    <p class="section-product-title">
                        Fresho Kiwi - Green, 3 pcs
                    </p>
                    <div class="section-product-info">
                        <figure class="section-product-image">
                            <img src="res/img/products/fruit-n-veg/kiwi-green.jpg" alt="Kiwi Green">
                        </figure>
                        <p class="section-product-details">
                            Kiwis are oval shaped with a brownish outer skin. The flesh is bright green and juicy with
                            tiny,
                            edible black seeds.
                        </p>
                    </div>
                    <div class="section-product-cost">
                        <p class="section-product-rate">
                            MRP Rs.87
                        </p>
                        <button class="BuyBtn">Buy Now</button>
                    </div>
                </div>
                <div class="section-product">
                    <p class="section-product-title">
                        Apple - Washington, Regular, 4 pcs
                    </p>
                    <div class="section-product-info">
                        <figure class="section-product-image">
                            <img src="res/img/products/fruit-n-veg/apple.jpg" alt="Kiwi Green">
                        </figure>
                        <p class="section-product-details">
                            The bright red coloured and heart shaped Washington apples are crunchy, juicy and slightly
                            sweet. Washington Apples are a natural source of fibre and are fat free.
                        </p>
                    </div>
                    <div class="section-product-cost">
                        <p class="section-product-rate">
                            MRP Rs.187
                        </p>
                        <button class="BuyBtn">Buy Now</button>
                    </div>
                </div>
                <div class="section-product">
                    <p class="section-product-title">
                        Fresho Pomegrante Peeled, 500 gm
                    </p>
                    <div class="section-product-info">
                        <figure class="section-product-image">
                            <img src="res/img/products/fruit-n-veg/pomegrante.jpg" alt="Kiwi Green">
                        </figure>
                        <p class="section-product-details">
                            Pomegranate variety has a glossy, vibrant and soft ruby-red skin. The inside of the fruit is
                            divided into compartments by thin white membranes.
                        </p>
                    </div>
                    <div class="section-product-cost">
                        <p class="section-product-rate">
                            MRP Rs.88
                        </p>
                        <button class="BuyBtn">Buy Now</button>
                    </div>
                </div>
                <div class="section-product">
                    <p class="section-product-title">
                        Capsicum - Green, 1kg
                    </p>
                    <div class="section-product-info">
                        <figure class="section-product-image">
                            <img src="res/img/products/fruit-n-veg/capsicum-green.jpg" alt="Kiwi Green">
                        </figure>
                        <p class="section-product-details">
                            Leaving a moderately pungent taste on the tongue, Green capsicums, also known as green
                            peppers
                            are bell shaped, medium-sized fruit pods.
                        </p>
                    </div>
                    <div class="section-product-cost">
                        <p class="section-product-rate">
                            MRP Rs.137
                        </p>
                        <button class="BuyBtn">Buy Now</button>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <section class="section-modal-box">
        <div class="modal-cart-header">
            <p>My Cart</p>
            <p onclick="closeModalBox()">X</p>
        </div>
        <div class="modal-cart-items">

        </div>

        <button class="modal-cart-start-shopping">Start Shopping</button>
    </section>

</body>

<script>
    let totalCartItems = 0;
    let cartItems = document.querySelector('.cart__items');
    let modalCartItems = document.querySelector('.modal-cart-items');
    let cartItemsArray = [];
    let cartItemsArray2 = [];
    let count = 0;
    let itemImage;
    let itemName;
    let itemPrice;
    let total;

    if (totalCartItems === 0) {
        modalCartItems.innerHTML = `<p>No items in your cart</p>
                                            <p>Your favorite items are just a click way</p>`;
    }

    [...document.querySelectorAll('.BuyBtn')].forEach((item) => {
        item.addEventListener('click', (e) => {

            if (totalCartItems == 0) {
                modalCartItems.innerHTML = '';
            }

            totalCartItems++;

            total = 1;

            cartItemsArray.forEach(e => {
                total = total + e.count
            })

            if (totalCartItems != 0) {
                cartItems.textContent = `${totalCartItems} Items`;
            }

            itemName = e.target.parentNode.parentNode.firstElementChild.textContent.trim();
            itemImage = e.target.parentNode.parentNode.firstElementChild.nextElementSibling.firstElementChild.firstElementChild.src;
            itemPrice = e.target.parentNode.firstElementChild.textContent.trim();


            function counter(arr, name) {
                const { length } = arr;
                const found = arr.some(el => el.productName === name);
                if (!found) {
                    count = 1;
                    arr.push({
                        count,
                        productName: name,
                        productImage: itemImage,
                        productPrice: itemPrice.replace(/[^0-9]/g, ''),
                        get productCost() {
                            return Number(this.count) * Number(this.productPrice);
                        }
                    });
                } else {
                    arr.forEach(el => {
                        if (el.productName == name) {
                            el.count = el.count + 1
                        }
                    })
                }
                return arr;
            }

            counter(cartItemsArray, itemName)

        });
    });



    function sub(e) {
        e.preventDefault();
        let productName = e.target.parentNode.parentNode.parentNode.firstElementChild.firstElementChild.textContent.trim();
        cartItemsArray.forEach(el => {
            if (el.productName == productName) {
                el.count = el.count - 1
            }
            if (el.count === 0) {
                console.log(e.target)
                e.target.disabled = true;
            }
        })

        modalCartItems.innerHTML = '';


        cartItemsArray.forEach(each => ui(each))
    }

    function add(e) {
        e.preventDefault();
        let productName = e.target.parentNode.parentNode.parentNode.firstElementChild.firstElementChild.textContent.trim();
        cartItemsArray.forEach(el => {
            if (el.productName == productName) {
                el.count = el.count + 1
            }
        })

        total = 0;

        cartItemsArray.forEach(e => {
            total = total + e.count
        })

        modalCartItems.innerHTML = '';

        cartItemsArray.forEach(each => ui(each))
    }

    function closeModalBox() {
        document.querySelector('.section-modal-box').style.display = 'none';
    }

    function showModalBox() {
        document.querySelector('.section-modal-box').style.display = 'block';

        console.log(cartItemsArray)

        modalCartItems.innerHTML = '';

        cartItemsArray.forEach(each => ui(each))
    }

    let ui = (each) => {
        modalCartItems.innerHTML += `
                <div class="modal-cart-not-empty">
                <figure>
                    <img src="${each.productImage}" alt="Capsicum">
                </figure>
                <div class="modal-cart-items-details">
                    <div class="modal-cart-item-name">
                        <p>${each.productName}</p>
                    </div>
                    <div class="modal-cart-item-quantity">
                        <form action="">
                            <button class="sub" onclick = "sub(event)">-</button>
                            <label for=""> ${each.count} </label>
                            <button class="add" onclick = "add(event)">+</button>
                            <label for=""> X ${each.productPrice}</label>
                        
                        </form>
                    </div>
                </div>
                <div class="modal-cart-item-price">
                    MRP Rs. ${each.productCost}
                </div>
            </div>
             `
    }

    function myFunction() {
        var x = document.getElementById("myLinks");
        if (x.style.display === "block") {
            x.style.display = "none";
        } else {
            x.style.display = "block";
        }
    }

</script>

</html>